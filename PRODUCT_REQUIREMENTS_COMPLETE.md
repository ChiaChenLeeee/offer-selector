# Offer 选择器 - 完整产品需求文档

## 1. 产品概述

### 1.1 产品定位
一个帮助求职者科学对比和评估多个工作机会的 Web 应用，采用 Notion 风格的现代化设计。

### 1.2 核心价值
- 多维度量化评估工作机会
- 自定义评分维度和权重
- 云端数据同步，随时随地访问
- 直观的可视化对比界面

---

## 2. 核心功能需求

### 2.1 用户认证系统

#### 2.1.1 Magic Link 邮箱登录
- **功能描述**：用户通过邮箱接收登录链接，无需密码
- **交互流程**：
  1. 用户输入邮箱地址
  2. 系统发送包含登录链接的邮件
  3. 用户点击邮件中的链接完成登录
  4. 自动跳转到应用主界面
- **状态显示**：
  - 未登录：侧边栏显示"未登录"灰色标签
  - 已登录：侧边栏显示"已登录"绿色标签
- **技术实现**：Supabase Auth + Magic Link

#### 2.1.2 会话管理
- 自动保持登录状态
- 支持退出登录功能
- 登录状态持久化

---

### 2.2 Offer 管理功能

#### 2.2.1 Offer 列表展示
- **布局**：卡片式网格布局（响应式：1列/2列/3列）
- **卡片信息**：
  - 综合评分（大号数字，紫色渐变）
  - 公司名称
  - 岗位名称
  - 预估年薪（万元）
- **排序**：按综合评分从高到低自动排序

#### 2.2.2 新建 Offer
- **入口**：页面顶部"新建 Offer"按钮（紫色主题）
- **必填字段**：
  - 公司名称
  - 岗位名称
- **评分维度**：根据已启用的维度动态生成输入表单
- **交互**：
  - 展开式卡片编辑
  - 实时保存提示
  - 取消/保存按钮

#### 2.2.3 编辑 Offer
- **入口**：卡片上的编辑按钮
- **功能**：
  - 展开卡片显示完整编辑表单
  - 修改任意维度的值
  - 实时计算并更新评分
  - 保存后自动重新排序

#### 2.2.4 删除 Offer
- **入口**：卡片上的删除按钮
- **交互**：弹出确认对话框
- **效果**：删除后立即从列表移除

---

### 2.3 评分维度管理

#### 2.3.1 维度分类系统
系统将所有维度分为三大类：

**岗位客观事实（蓝色主题）**
- 薪酬待遇
- 工作地点
- 上班时长
- 年假天数
- 每年调薪幅度

**岗位主观因素（紫色主题）**
- 岗位 title 价值打分
- 业务是否核心
- 老板是否经常 PUA（扣分维度）
- 能力提升机会
- 领导风格
- 团队氛围
- 业务前景
- 组内离职情况
- 晋升机会
- 后续跳槽难度

**个人生活成长（橙色主题）**
- 主业是否赋能副业
- 是否有时间做副业
- 个人娱乐时间

#### 2.3.2 维度配置界面
- **布局**：三列卡片，每列对应一个分类
- **每个维度显示**：
  - 复选框（启用/禁用）
  - 维度名称
  - 扣分标签（如适用）
  - 编辑/删除按钮
- **折叠展开**：每个分类默认显示前3个，可展开查看全部

#### 2.3.3 自定义维度
- **添加维度**：
  - 点击分类卡片的"+"按钮
  - 输入维度名称
  - 自动生成默认选项（符合预期/一般/不确定/不符合预期）
  - 自动计算分数权重
- **编辑维度**：
  - 修改维度名称
  - 添加/删除/重排子选项
  - 编辑选项标签
  - 自动重新计算分数分布
- **删除维度**：仅限自定义维度

#### 2.3.4 维度类型
系统支持多种维度类型：

1. **薪酬类型**（salary）
   - 输入：月薪、月数、奖金
   - 计算：年薪总额
   - 评分：相对于所有 Offer 的最高薪酬

2. **地点类型**（location）
   - 输入：城市名称 + 符合程度
   - 选项：符合预期(100分)/无所谓(50分)/不符合预期(20分)

3. **单选类型**（select）
   - 自定义选项列表
   - 每个选项对应一个分数
   - 支持扣分选项（负分）

4. **数值类型**（numeric）
   - 输入数字
   - 相对评分（相对于最大值）

5. **滑动条类型**（slider）
   - 0-100 分直接打分

---

### 2.4 权重排序系统

#### 2.4.1 拖拽排序
- **界面**：垂直列表，每个维度一行
- **交互**：
  - 鼠标拖拽改变顺序
  - 上移/下移按钮
  - 实时显示权重百分比
- **视觉反馈**：
  - 拖拽时半透明
  - 放置位置高亮
  - 权重条动画过渡

#### 2.4.2 权重计算公式
```
排名第 i 位的权重 = (n - i + 1) / [n(n+1)/2]
```
- n = 启用维度总数
- i = 当前维度排名（1开始）
- 权重总和 = 100%

#### 2.4.3 权重可视化
- 百分比数字显示
- 彩色进度条
- 分类颜色标识
- 扣分维度特殊标识（红色）

---

### 2.5 云端数据同步

#### 2.5.1 自动保存机制
- **触发条件**：数据变更后 2 秒
- **保存内容**：
  - 所有维度配置
  - 所有 Offer 数据
- **状态指示器**（侧边栏底部）：
  - 正在保存...（旋转图标）
  - 已保存到云端（绿色云图标）
  - 保存失败（红色云图标）
  - 自动保存已启用（灰色云图标）

#### 2.5.2 手动同步
- **保存到云端**：立即上传当前数据
- **从云端加载**：拉取最新云端数据
- **同步按钮**：位于"我的"页面

#### 2.5.3 数据存储
- **本地存储**：LocalStorage（离线可用）
- **云端存储**：Supabase Database
- **同步策略**：
  - 登录后自动从云端加载
  - 数据变更后自动保存到云端
  - 本地和云端双重保障

---

## 3. 界面设计规范

### 3.1 整体布局

#### 3.1.1 Notion 风格布局
```
┌─────────────┬──────────────────────────────┐
│             │                              │
│   侧边栏    │        主内容区              │
│  (240px)    │                              │
│             │                              │
│   Logo      │                              │
│   导航菜单  │        页面内容              │
│   状态指示  │                              │
│             │                              │
└─────────────┴──────────────────────────────┘
```

#### 3.1.2 侧边栏（固定左侧）
- **宽度**：240px
- **背景**：白色 (#FFFFFF)
- **边框**：右侧 1px 灰色边框
- **内容**：
  - Logo 和标题
  - 导航菜单
  - 自动保存状态指示器

#### 3.1.3 主内容区
- **左边距**：240px（侧边栏宽度）
- **最大宽度**：1280px（居中）
- **内边距**：64px 左右，48px 上下
- **背景**：浅灰色 (#FBFBFA)

---

### 3.2 颜色系统

#### 3.2.1 主题色
- **主色调**：紫色 (#7C3AED / purple-600)
- **辅助色**：靛蓝 (#4F46E5 / indigo-600)
- **渐变**：purple-600 → indigo-600

#### 3.2.2 分类颜色
- **岗位客观事实**：蓝色系
  - 主色：#2563EB (blue-600)
  - 浅色背景：#EFF6FF (blue-50)
  - 边框：#BFDBFE (blue-200)

- **岗位主观因素**：紫色系
  - 主色：#7C3AED (purple-600)
  - 浅色背景：#F5F3FF (purple-50)
  - 边框：#DDD6FE (purple-200)

- **个人生活成长**：橙色系
  - 主色：#EA580C (orange-600)
  - 浅色背景：#FFF7ED (orange-50)
  - 边框：#FED7AA (orange-200)

#### 3.2.3 功能色
- **成功/已保存**：绿色 (#16A34A / green-600)
- **警告/扣分**：红色/玫瑰色 (#E11D48 / rose-600)
- **错误**：红色 (#DC2626 / red-600)
- **信息**：蓝色 (#3B82F6 / blue-500)

#### 3.2.4 中性色
- **文字主色**：#111827 (gray-900)
- **文字次要**：#6B7280 (gray-500)
- **文字禁用**：#D1D5DB (gray-300)
- **边框**：#E5E7EB (gray-200)
- **背景**：#F9FAFB (gray-50)

---

### 3.3 字体系统

#### 3.3.1 字体家族
```css
font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
```

#### 3.3.2 字号规范
- **超大标题**：32px (2xl) - 页面主标题
- **大标题**：24px (xl) - 区块标题
- **中标题**：18px (lg) - 卡片标题
- **正文**：14px (sm) - 主要内容
- **小字**：12px (xs) - 辅助信息
- **超小字**：10px (2xs) - 标签、徽章

#### 3.3.3 字重
- **粗体**：600 (semibold) - 标题、强调
- **中等**：500 (medium) - 次要标题
- **常规**：400 (normal) - 正文

---

### 3.4 组件设计

#### 3.4.1 导航按钮
- **默认状态**：
  - 文字颜色：gray-600
  - 背景：透明
  - 圆角：6px
  - 内边距：12px 横向，6px 纵向

- **悬停状态**：
  - 背景：gray-50
  - 文字颜色：gray-900

- **激活状态**：
  - 背景：purple-50
  - 文字颜色：purple-700
  - 图标颜色：purple-600
  - 字重：500 (medium)

#### 3.4.2 Offer 卡片
- **尺寸**：自适应宽度，最小高度 200px
- **背景**：白色
- **边框**：1px gray-200
- **圆角**：8px
- **阴影**：
  - 默认：subtle shadow
  - 悬停：medium shadow
  - 编辑中：large shadow + purple-300 边框

- **卡片头部**：
  - 评分数字：48px，紫色渐变
  - 操作按钮：右上角，悬停显示

- **卡片内容**：
  - 公司/岗位：14px，gray-900
  - 年薪：14px，purple-600
  - 标签：12px，gray-400

#### 3.4.3 按钮样式
- **主要按钮**：
  - 背景：purple-600
  - 文字：白色
  - 悬停：purple-700
  - 圆角：8px
  - 内边距：12px 16px

- **次要按钮**：
  - 背景：purple-50
  - 文字：purple-700
  - 悬停：purple-100
  - 圆角：8px

- **危险按钮**：
  - 背景：red-50
  - 文字：red-600
  - 悬停：red-100

#### 3.4.4 输入框
- **边框**：1px gray-200
- **圆角**：8px
- **内边距**：8px 12px
- **聚焦**：
  - 边框：purple-300
  - 外发光：2px purple-50

#### 3.4.5 分类卡片
- **背景**：白色
- **边框**：1px gray-200
- **圆角**：8px
- **内边距**：20px
- **标题**：
  - 分类圆点（12px）
  - 分类名称（14px，semibold）
  - 数量标签（12px，gray-400）

---

### 3.5 交互动画

#### 3.5.1 过渡效果
- **通用过渡**：200ms ease-in-out
- **颜色变化**：150ms
- **尺寸变化**：300ms
- **透明度**：200ms

#### 3.5.2 悬停效果
- 按钮：背景色渐变
- 卡片：阴影增强 + 轻微上移
- 链接：颜色加深

#### 3.5.3 加载动画
- 旋转图标：360度旋转，1秒循环
- 进度条：宽度动画，500ms

---

## 4. 页面结构

### 4.1 Offer 合集页
- 页面标题："Offer 合集"
- 副标题："管理和对比你的工作机会"
- 新建按钮
- Offer 卡片网格
- 空状态提示

### 4.2 打分规则页
- 页面标题："打分规则"
- 副标题："自定义评分维度和权重"
- 重置按钮
- 维度配置区（三列卡片）
- 权重排序区

### 4.3 我的页面
- **未登录状态**：
  - 登录表单
  - 邮箱输入框
  - 发送登录链接按钮
  - 邮件发送成功提示

- **已登录状态**：
  - 用户信息卡片（头像、邮箱、用户ID）
  - 退出登录按钮
  - 数据同步卡片
  - 手动同步按钮

### 4.4 AI 解读页（占位）
- 标题："AI 解读"
- 描述："即将推出"

### 4.5 社区页（占位）
- 标题："社区"
- 描述："即将推出"

---

## 5. 技术实现

### 5.1 技术栈
- **前端框架**：React 19.2.3 + TypeScript
- **构建工具**：Vite 5.0.8
- **样式方案**：Tailwind CSS 3.4.1
- **图标库**：Lucide React 0.460.0
- **后端服务**：Supabase
  - 认证：Supabase Auth
  - 数据库：PostgreSQL
  - 实时同步：Supabase Realtime

### 5.2 数据模型

#### 5.2.1 Dimension（维度）
```typescript
interface Dimension {
  id: string;                    // 唯一标识
  name: string;                  // 维度名称
  type: DimensionType;           // 维度类型
  category: DimensionCategory;   // 分类
  description?: string;          // 描述
  isDefault: boolean;            // 是否默认维度
  active: boolean;               // 是否启用
  options?: DimensionOption[];   // 选项列表
  isPenalty?: boolean;           // 是否扣分维度
}
```

#### 5.2.2 Offer
```typescript
interface Offer {
  id: string;                           // 唯一标识
  values: Record<string, any>;          // 维度值映射
  extraBonuses: ExtraBonus[];           // 额外加分
}
```

#### 5.2.3 数据库表结构
- **user_dimensions**：存储用户的维度配置
  - user_id (主键)
  - dimensions (JSONB)
  - updated_at

- **user_offers**：存储用户的 Offer 数据
  - user_id (主键)
  - offers (JSONB)
  - updated_at

### 5.3 评分算法

#### 5.3.1 权重计算
```typescript
权重[i] = (n - i + 1) / (n * (n + 1) / 2)
```

#### 5.3.2 综合评分
```typescript
综合评分 = Σ(维度分数[i] × 权重[i]) + 额外加分
```

#### 5.3.3 维度评分规则
- 薪酬：相对最高薪酬的百分比
- 地点：选项对应分数
- 单选：选项对应分数
- 数值：相对最大值的百分比
- 滑动条：直接使用分数

---

## 6. 用户体验细节

### 6.1 响应式设计
- **桌面端**：≥1024px，3列卡片
- **平板端**：768px-1023px，2列卡片
- **移动端**：<768px，1列卡片

### 6.2 加载状态
- 初始加载：全屏加载动画
- 数据同步：侧边栏状态指示器
- 按钮操作：按钮内加载图标

### 6.3 错误处理
- 网络错误：Toast 提示
- 表单验证：内联错误提示
- 保存失败：状态指示器显示错误

### 6.4 空状态
- 无 Offer：引导创建第一个 Offer
- 无启用维度：提示启用维度
- 未登录：引导登录

---

## 7. 性能要求

### 7.1 加载性能
- 首屏加载：< 2秒
- 页面切换：< 300ms
- 数据保存：< 1秒

### 7.2 交互性能
- 按钮响应：< 100ms
- 拖拽流畅度：60fps
- 动画流畅度：60fps

---

## 8. 浏览器兼容性
- Chrome：最新版本
- Firefox：最新版本
- Safari：最新版本
- Edge：最新版本

---

## 9. 未来规划
- AI 智能解读功能
- 社区分享功能
- 数据导出功能
- 移动端 App

---

**文档版本**：1.0  
**最后更新**：2025年2月5日  
**基于版本**：job-offer-selector-3 (昨天23:00)
